// CSS COLOR PARSER CODE
//
// (c) Dean McNamee <dean@gmail.com>, 2012.
//
// https://github.com/deanm/css-color-parser-js
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to
// deal in the Software without restriction, including without limitation the
// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
// sell copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
// IN THE SOFTWARE.
// http://www.w3.org/TR/css3-color/
var cssColorParser=function(){function t(e){return e=Math.round(e),e<0?0:e>255?255:e}function n(e){return e<0?0:e>1?1:e}function r(e){return e[e.length-1]==="%"?t(parseFloat(e)/100*255):t(parseInt(e))}function i(e){return e[e.length-1]==="%"?n(parseFloat(e)/100):n(parseFloat(e))}function s(e,t,n){return n<0?n+=1:n>1&&(n-=1),n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}function o(n){var o=n.replace(/ /g,"").toLowerCase();if(o in e)return e[o].slice();if(o[0]==="#"){if(o.length===4){var u=parseInt(o.substr(1),16);return u>=0&&u<=4095?[(u&3840)>>4|(u&3840)>>8,u&240|(u&240)>>4,u&15|(u&15)<<4,1]:null}if(o.length===7){var u=parseInt(o.substr(1),16);return u>=0&&u<=16777215?[(u&16711680)>>16,(u&65280)>>8,u&255,1]:null}return null}var a=o.indexOf("("),f=o.indexOf(")");if(a!==-1&&f+1===o.length){var l=o.substr(0,a),c=o.substr(a+1,f-(a+1)).split(","),h=1;switch(l){case"rgba":if(c.length!==4)return null;h=i(c.pop());case"rgb":if(c.length!==3)return null;return[r(c[0]),r(c[1]),r(c[2]),h];case"hsla":if(c.length!==4)return null;h=i(c.pop());case"hsl":if(c.length!==3)return null;var p=(parseFloat(c[0])%360+360)%360/360,d=i(c[1]),v=i(c[2]),m=v<=.5?v*(d+1):v+d-v*d,g=v*2-m;return[t(s(g,m,p+1/3)*255),t(s(g,m,p)*255),t(s(g,m,p-1/3)*255),h];default:return null}}return null}var e={rebeccapurple:[102,51,153],transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};return o}(),ColorManager=function(){function e(e,n,r,i){return e=t(e,0,255),n=t(n,0,255),r=t(r,0,255),i=t(i,0,255),"rgba("+Math.floor(e)+","+Math.floor(n)+","+Math.floor(r)+","+i+")"}function t(e,t,n){return Math.max(t,Math.min(e,n))}function n(e,t,n){return t*n+e*(1-n)}function r(e,t,r,i){var s=(t-r)*i,o=Math.floor(s),u=s-o,a=o+1;return a>e.length-1&&(a=o),{r:n(e[o][0],e[a][0],u),g:n(e[o][1],e[a][1],u),b:n(e[o][2],e[a][2],u),a:n(e[o][3],e[a][3],u)}}function i(e,t,n,r){var i=Math.floor((t-n)*r);return{r:e[i][0],g:e[i][1],b:e[i][2],a:e[i][3]}}function s(e,t){return e*=t,e>255?255:e}function o(e,t){return{r:s(e.r,t),g:s(e.g,t),b:s(e.b,t),a:e.a}}function u(e){return cssColorParser(e)}this.getColor=function(){console.error("ColorManager: colors have not been setup")},this.colors=[],this.setup=function(t,n,s,a,f){var l,c,h=n-t,p=t;a==="gradient"?(l=r,c=(s.length-1)/(h-1)):(l=i,c=s.length/(h+1)),this.colors=s.map(function(e){return u(e)}),this.getColor=function(t){var n=l(this.colors,t,p,c),r=o(n,f);return{color:e(n.r,n.g,n.b,n.a),highlight:e(r.r,r.g,r.b,r.a)}}}};(function(){"use strict";var e=this,t=e.Chart,n=t.helpers,r={backgroundColor:"#fff",stroke:!1,strokePerc:.05,strokeColor:"rgb(128,128,128)",highlightStrokeColor:"rgb(192,192,192)",rounded:!0,roundedRadius:.1,paddingScale:.05,colorInterpolation:"gradient",colors:["rgba(220,220,220,0.9)","rgba(151,187,205,0.9)"],colorHighlight:!0,colorHighlightMultiplier:.92,showLabels:!0,labelScale:.2,labelFontFamily:'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif',labelFontStyle:"normal",labelFontColor:"rgba(0,0,0,0.5)",tooltipTemplate:"<%= xLabel %> | <%= yLabel %> : <%= value %>",legendTemplate:'<div class="<%= name.toLowerCase() %>-legend"><span class="<%= name.toLowerCase() %>-legend-text"><%= min %></span><% for (var i = min; i <= max; i += (max-min)/6){ %><span class="<%= name.toLowerCase() %>-legend-box" style="background-color: <%= colorManager.getColor(i).color %>;">&nbsp; </span><% } %><span class="<%= name.toLowerCase() %>-legend-text"><%= max %></span></div>'};t.Type.extend({name:"HeatMap",defaults:r,initialize:function(e){var r=this.options;this.max=-Infinity,this.min=Infinity,this.colorManager=new ColorManager,this.ScaleClass=t.Scale.extend({offsetGridLines:!0,calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)},calculateBoxWidth:function(e,t){var n=this.calculateBaseWidth()-e-1,r=Math.max(e,t);return this.calculateBaseWidth()},calculateBoxHeight:function(){return this.calculateY(0)-this.calculateY(1)},buildYLabels:function(){this.yLabelWidth=this.display&&this.showLabels?n.longestText(this.ctx,this.font,this.yLabels):0},draw:function(){var e=this.ctx,t=(this.endPoint-this.startPoint)/this.steps,r=Math.round(this.xScalePaddingLeft);this.display&&(e.fillStyle=this.textColor,e.font=this.font,n.each(this.yLabels,function(n,i){var s=this.endPoint-t*i-t*.5,o=Math.round(s),u=this.showHorizontalLines;e.textAlign="right",e.textBaseline="middle",this.showLabels&&e.fillText(n,r-10,s)},this),n.each(this.xLabels,function(t,r){var i=this.calculateX(r)+n.aliasPixel(this.lineWidth),s=this.calculateX(r-(this.offsetGridLines?.5:0))+n.aliasPixel(this.lineWidth),o=this.xLabelRotation>0,u=this.showVerticalLines;e.lineWidth=this.lineWidth,e.strokeStyle=this.lineColor,e.save(),e.translate(i,o?this.endPoint+12:this.endPoint+8),e.rotate(n.radians(this.xLabelRotation)*-1),e.font=this.font,e.textAlign=o?"right":"center",e.textBaseline=o?"middle":"top",e.fillText(t,0,0),e.restore()},this))}}),this.datasets=[],this.yLabels=[],this.xLabels=e.labels,this.options.showTooltips&&n.bindEvents(this,this.options.tooltipEvents,function(e){var t=e.type!=="mouseout"?this.getBoxAtEvent(e):undefined;this.activeElement=t,this.eachBoxes(function(e){e.restore(["fillColor","strokeColor"])}),t&&(t.fillColor=t.highlightFill,t.strokeColor=t.highlightStroke),this.showTooltip(t)}),this.BoxClass=t.Rectangle.extend({strokePerc:this.options.strokePerc,strokeColor:this.options.strokeColor,showStroke:this.options.stroke,fontColor:this.options.labelFontColor,fontFamily:this.options.labelFontFamily,fontScale:this.options.labelScale,showLabels:this.options.showLabels,radiusScale:this.options.rounded?this.options.roundedRadius:0,paddingScale:this.options.paddingScale,ctx:this.chart.ctx,draw:function(){var e=this.ctx,t=this.width/2,r=this.width,i=this.height,s=this.x-t,o=this.y,u=this.strokePerc*this.width,a=u/2,f=this.paddingScale*r,l=this.paddingScale*i;s+=f*.5,o+=l*.5,r-=f,i-=l,this.showStroke&&(s+=a,r-=a,i-=a,o+=a),e.fillStyle=this.fillColor,e.strokeStyle=this.strokeColor,e.lineWidth=u,n.drawRoundedRectangle(e,s,o,r,i,this.radiusScale*this.width),e.fill(),this.showStroke&&e.stroke(),this.showLabels&&this.label!==null&&this.label!==undefined&&(e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.fontColor,e.font=this.height*this.fontScale+"px "+this.fontFamily,e.fillText(this.value,s+r*.5,o+i*.5))}}),n.each(e.datasets,function(e,t){var r={label:e.label||null,boxes:[]};this.datasets.push(r),this.yLabels.push(e.label),n.each(e.data,function(t,n){r.boxes.push(new this.BoxClass({value:t,label:this.xLabels[n],datasetLabel:e.label,strokeColor:this.options.strokeColor,fillColor:"white",highlightFill:"black",highlightStroke:this.options.highlightStrokeColor}))},this)},this),this.datasets.reverse(),this.yLabels.reverse(),this.buildScale(e.labels,this.yLabels),this.BoxClass.prototype.base=this.scale.endPoint,this.eachBoxes(function(e,t,r){n.extend(e,{x:this.scale.calculateX(t),y:this.scale.calculateY(r+1),width:this.scale.calculateBoxWidth(),height:this.scale.calculateBoxHeight()}),e.save()},this),this.findMaxAndMin(!0),this.applyColors(),this.render()},update:function(){this.scale.update(),this.activeElement&&this.activeElement.restore(["fillColor","strokeColor"]),this.eachBoxes(function(e){e.save()}),this.render()},eachBoxes:function(e){n.each(this.datasets,function(t,r){n.each(t.boxes,e,this,r)},this)},getBoxAtEvent:function(e){var t=n.getRelativePosition(e),r;for(var i=0;i<this.datasets.length;i++)for(r=0;r<this.datasets[i].boxes.length;r++)if(this.datasets[i].boxes[r].inRange(t.x,t.y))return this.datasets[i].boxes[r];return undefined},buildScale:function(e,t){var r=this,i=function(){var e=[];return r.eachBoxes(function(t){e.push(t.value)}),e},s={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:e.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(e){var t={min:0,max:r.datasets.length,steps:r.datasets.length,stepValue:1};n.extend(this,t)},xLabels:e,yLabels:t,font:n.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.stroke?this.options.strokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.scale=new this.ScaleClass(s)},addDataset:function(e,t){var r={label:t,boxes:[]},i=this.datasets.length;n.each(e,function(e,n){r.boxes.push(new this.BoxClass({value:e,label:this.xLabels[n],x:this.scale.calculateX(n),y:this.scale.calculateY(0),width:this.scale.calculateBoxWidth()+1,height:this.scale.calculateBoxHeight()+1,datasetLabel:t,strokeColor:this.options.strokeColor,highlightStroke:this.options.highlightStrokeColor}))},this),this.datasets.unshift(r),this.scale.yLabels.unshift(t),this.scale.steps+=1,this.scale.max+=1,this.scale.fit(),this.findMaxAndMin(!0),this.applyColors(),this.update()},removeDataset:function(){this.datasets.pop(),this.scale.yLabels.pop(),this.scale.steps-=1,this.scale.max-=1,this.scale.fit(),this.findMaxAndMin(!0),this.applyColors(),this.update()},applyColors:function(){this.colorManager.setup(this.min,this.max,this.options.colors,this.options.colorInterpolation,this.options.colorHighlightMultiplier),this.eachBoxes(function(e){var t=this.colorManager.getColor(e.value);e.fillColor=t.color,e.highlightFill=t.highlight,e.strokeColor=this.options.strokeColor,e.highlightStroke=this.options.highlightStrokeColor,e.save()})},findMaxAndMin:function(e){e&&(this.min=Infinity,this.max=-Infinity),this.eachBoxes(function(e,t,n){e.value>this.max&&(this.max=e.value),e.value<this.min&&(this.min=e.value)})},addData:function(e,t){e=e.concat().reverse();var r=this.datasets[0].boxes.length;n.each(e,function(e,n){this.datasets[n].boxes.push(new this.BoxClass({value:e,label:t,datasetLabel:this.datasets[n].label,x:this.scale.calculateX(r),y:this.scale.calculateY(n+1),width:this.scale.calculateBoxWidth()+1,height:this.scale.calculateBoxHeight()+1,strokeColor:this.options.strokeColor,highlightStroke:this.options.highlightStrokeColor}))},this),this.findMaxAndMin(!0),this.applyColor(),this.scale.addXLabel(t),this.update()},removeData:function(){this.scale.removeXLabel(),n.each(this.datasets,function(e){e.boxes.shift()},this),this.findMaxAndMin(!0),this.applyColors(),this.update()},reflow:function(){n.extend(this.BoxClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var e=n.extend({height:this.chart.height,width:this.chart.width});this.scale.update(e)},showTooltip:function(e){this.draw();if(e){var r=e.tooltipPosition(),i={yLabel:e.datasetLabel,xLabel:e.label,value:e.value};(new t.Tooltip({x:Math.round(r.x),y:Math.round(r.y+20),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,caretHeight:this.options.tooltipCaretSize,cornerRadius:this.options.tooltipCornerRadius,text:n.template(this.options.tooltipTemplate,i),chart:this.chart,custom:this.options.customTooltips})).draw()}return this},draw:function(e){var t=e||1;this.clear(),this.scale.draw(t),this.eachBoxes(function(e,n,r){e.transition({x:this.scale.calculateX(n),y:this.scale.calculateY(r+1),width:this.scale.calculateBoxWidth()+1,height:this.scale.calculateBoxHeight()+1},t).draw()})}})}).call(this);